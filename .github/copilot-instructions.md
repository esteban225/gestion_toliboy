# Gestion Toliboy - Laravel Management System

Gestion Toliboy is a Laravel 12.0 web application for managing production batches, inventory, forms, and work logs. It features JWT-based authentication with role-based access control (Developer, Admin), a RESTful API, and a modern frontend built with Vite and TailwindCSS.

Always reference these instructions first and fallback to search or bash commands only when you encounter unexpected information that does not match the info here.

## Working Effectively

### Bootstrap and Setup
1. **Install PHP dependencies** (REQUIRED FOR PHP 8.3):
   - `composer update --no-interaction` -- takes 5-6 minutes. NEVER CANCEL. Set timeout to 10+ minutes.
   - This is required due to PHP 8.3 compatibility issues with locked dependencies
   - After update: `composer install --no-interaction`

2. **Install Node.js dependencies**:
   - `npm install` -- takes ~10 seconds
   - `npm audit fix` -- fixes security vulnerabilities, takes ~1 second

3. **Environment setup**:
   - `cp .env.example .env`
   - `php artisan key:generate`
   - `php artisan jwt:secret`

4. **Database setup**:
   - `touch database/database.sqlite`
   - `php artisan session:table` -- creates sessions table migration (required for web interface)
   - `php artisan migrate` -- takes ~0.2 seconds (creates basic Laravel tables only)

5. **Build frontend assets**:
   - `npm run build` -- takes ~1.5 seconds

### Running the Application

#### Development Server
- **Web application**: `php artisan serve --host=0.0.0.0 --port=8000`
- **Access at**: http://localhost:8000
- **Development mode with hot reload**: Set `LARAVEL_BYPASS_ENV_CHECK=1` in .env, then run `composer run dev`
  - Starts server, queue listener, and Vite concurrently
  - Vite will not work in CI environments without the bypass flag

#### API Development
- **Base URL**: http://localhost:8000/api
- **Authentication**: JWT tokens required for most endpoints
- **Available routes**: See `routes/api.php` for complete API documentation
- **Role-based access**: Developer and Admin roles with different permissions

### Testing and Quality Assurance

#### Running Tests
- `php artisan test` -- takes ~0.5 seconds. Uses Pest testing framework.
- Test coverage: Basic unit and feature tests included
- Tests use in-memory SQLite database

#### Code Formatting and Linting
- **Check formatting**: `vendor/bin/pint --test` -- takes ~5 seconds
- **Fix formatting**: `vendor/bin/pint`
- **CRITICAL**: Always run Pint before committing. The current codebase has 37+ style violations that will cause CI failures if not fixed.

### Build Times and Timeouts
- **Composer update**: 5-6 minutes (NEVER CANCEL - set 10+ minute timeout)
- **NPM install**: 10 seconds
- **Frontend build**: 1.5 seconds
- **Tests**: 0.5 seconds  
- **Pint formatting**: 5 seconds
- **Database migrations**: 0.2 seconds

## Validation and Manual Testing

### Manual Validation Steps
1. **Verify application starts**: 
   - Run `php artisan serve`
   - Visit http://localhost:8000
   - Should see Laravel welcome page with "Let's get started" heading and functional navigation

2. **Verify API structure**:
   - Test unauthenticated endpoint: `curl http://localhost:8000/api/users` (should return 401 Unauthorized)
   - Check `routes/api.php` for available endpoints
   - Most endpoints require JWT authentication and Developer role

3. **Verify build process**:
   - Run `npm run build`
   - Check `public/build/` directory contains generated assets
   - Verify manifest.json and CSS/JS files are created (~33KB CSS, ~36KB JS)

## Database and Models

### Database Schema
- **Default configuration**: SQLite database (`database/database.sqlite`)
- **Basic Laravel tables**: cache, jobs, migrations, personal_access_tokens, sessions
- **Sessions table required**: Run `php artisan session:table` then `php artisan migrate` for web interface
- **Expected schema**: Models suggest additional tables (users, roles, batches, products, raw_materials, forms, work_logs, etc.)
- **Models generated by**: Reliese Laravel package (`php artisan code:models` available)

### Known Issues
- **Database seeding fails**: User factory not compatible with custom User model
- **Missing schema**: Application models expect tables that don't exist in current migrations
- **Role-based auth**: Requires proper user and role tables for full functionality

## Common Tasks

### Development Workflow
1. Always run `composer update` first on fresh clone (PHP 8.3 requirement)
2. Set up environment with `.env` configuration  
3. Run database migrations and build assets
4. Start development server
5. Make code changes
6. Run tests: `php artisan test`
7. Fix formatting: `vendor/bin/pint`
8. Test API endpoints manually if making API changes

### Key Directories and Files
- **Controllers**: `app/Http/Controllers/` - API endpoints for batches, forms, inventory, etc.
- **Models**: `app/Models/` - Eloquent models for all entities
- **Routes**: `routes/api.php` - RESTful API routes with JWT authentication
- **Frontend**: `resources/` - Blade templates, CSS, and JS assets
- **Config**: `config/` - Laravel configuration including JWT, database, auth settings

### Environment Variables
- **Required for Vite in CI**: `LARAVEL_BYPASS_ENV_CHECK=1`
- **Database**: Uses SQLite by default (`DB_CONNECTION=sqlite`)
- **JWT**: Configured with tymon/jwt-auth package

## Troubleshooting

### Common Issues
1. **Composer install fails**: Run `composer update` first due to PHP 8.3 compatibility
2. **Vite dev server fails in CI**: Add `LARAVEL_BYPASS_ENV_CHECK=1` to .env
3. **API endpoints return errors**: Database may need proper schema setup for User/Role tables
4. **Tests fail**: Ensure database is migrated for testing environment
5. **Code formatting failures**: Run `vendor/bin/pint` before committing

### Performance Notes
- Frontend builds are very fast (~1.5 seconds)
- Tests run quickly (~0.5 seconds)  
- Initial composer setup is slow (5-6 minutes) but subsequent installs are fast
- Database operations are fast due to SQLite

## Critical Warnings
- **NEVER CANCEL** composer update command - always allow 10+ minutes
- **ALWAYS run Pint** before committing to avoid CI failures
- **Database schema incomplete** - full functionality requires additional setup
- **JWT authentication required** for most API endpoints